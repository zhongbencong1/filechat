# 智能文档问答系统 - 项目架构

## 项目概述

已成功创建完整的智能文档问答系统，采用前后端分离架构，基于RAG（检索增强生成）技术实现文档智能问答功能。

## 已完成功能

### 1. 后端服务（Spring Boot）

#### 1.1 网关服务 (gateway)
- ✅ Spring Cloud Gateway路由转发
- ✅ Token认证拦截器
- ✅ 跨域配置
- ✅ 白名单路径配置

#### 1.2 文件管理服务 (file-service)
- ✅ 文件上传（支持doc/docx/txt/ppt/pptx/pdf）
- ✅ MinIO文件存储集成
- ✅ 文件元数据管理
- ✅ 文件列表查询
- ✅ 文件删除功能
- ✅ 文件格式校验

#### 1.3 文档解析服务 (document-service)
- ✅ 多格式文档解析（POI + PDFBox）
- ✅ 文本提取和清洗
- ✅ 异步文档解析
- ✅ 文本分片处理
- ✅ 向量化处理
- ✅ Milvus向量存储

#### 1.4 对话管理服务 (chat-service)
- ✅ 智能问答接口
- ✅ 向量检索集成
- ✅ 大模型对话生成
- ✅ 对话历史管理
- ✅ Redis缓存对话上下文
- ✅ 文档问答 vs 通用问答切换

#### 1.5 权限管理服务 (auth-service)
- ✅ 用户登录/注册
- ✅ Token生成和验证
- ✅ Redis Token存储
- ✅ 用户信息管理

#### 1.6 AI引擎模块 (ai-engine)
- ✅ 文本预处理和清洗
- ✅ 智能文本分片（200-500字符/块）
- ✅ 文本向量化服务
- ✅ Milvus向量数据库集成
- ✅ DeepSeek LLM集成
- ✅ RAG Prompt工程

#### 1.7 公共模块 (common)
- ✅ 统一返回结果封装
- ✅ 全局异常处理
- ✅ Redis配置
- ✅ MyBatis Plus配置
- ✅ 基础实体类

### 2. 前端应用 (Vue 3)

#### 2.1 用户界面
- ✅ 登录/注册页面
- ✅ 文件上传组件
- ✅ 文件列表展示
- ✅ 智能对话窗口
- ✅ 对话历史展示
- ✅ 文件状态显示

#### 2.2 功能特性
- ✅ 文件上传（支持多格式）
- ✅ 文档解析状态跟踪
- ✅ 实时对话交互
- ✅ 对话上下文保持
- ✅ 回答来源标识
- ✅ 响应式布局

### 3. 数据存储

#### 3.1 MySQL数据库
- ✅ 用户表（user）
- ✅ 文档表（document）
- ✅ 对话消息表（chat_message）
- ✅ 初始化SQL脚本

#### 3.2 Redis缓存
- ✅ Token存储
- ✅ 对话历史缓存
- ✅ 配置类封装

#### 3.3 MinIO对象存储
- ✅ 文件上传服务
- ✅ 文件下载服务
- ✅ Bucket管理

#### 3.4 Milvus向量数据库
- ✅ 集合创建和管理
- ✅ 向量插入
- ✅ 向量相似度搜索
- ✅ 索引创建

## 技术架构

```
前端 (Vue 3 + Element Plus)
    ↓
网关 (Spring Cloud Gateway)
    ↓
业务服务层
    ├── 文件管理服务
    ├── 文档解析服务
    ├── 对话管理服务
    └── 权限管理服务
    ↓
AI引擎层
    ├── 文本预处理
    ├── 文本分片
    ├── 向量化
    ├── 向量检索
    └── 大模型生成
    ↓
数据存储层
    ├── MySQL (元数据)
    ├── Redis (缓存)
    ├── MinIO (文件)
    └── Milvus (向量)
```

## 核心业务流程

### 文档上传流程
1. 用户上传文档 → 文件管理服务
2. 文件存入MinIO → 记录元数据到MySQL
3. 触发文档解析服务
4. 文档解析 → 文本提取 → 清洗 → 分片
5. 文本向量化 → 存入Milvus
6. 更新文档状态为"解析完成"

### 智能问答流程
1. 用户提问 → 对话管理服务
2. 问题向量化
3. Milvus向量检索（Top 5相关文本块）
4. 判断是否有相关文档内容
   - 有：RAG模式（基于文档内容回答）
   - 无：通用模式（AI自由回答）
5. 调用DeepSeek生成回答
6. 保存对话历史
7. 返回回答给前端

## 项目结构

```
smart-doc-qa/
├── backend/                    # 后端服务
│   ├── gateway/               # 网关服务 (8080)
│   ├── file-service/         # 文件管理服务 (8081)
│   ├── document-service/      # 文档解析服务 (8082)
│   ├── chat-service/          # 对话管理服务 (8083)
│   ├── auth-service/          # 权限管理服务 (8084)
│   ├── ai-engine/             # AI引擎模块
│   └── common/                # 公共模块
├── frontend/                  # 前端应用 (3000)
│   ├── src/
│   │   ├── api/              # API接口
│   │   ├── views/            # 页面组件
│   │   ├── router/           # 路由配置
│   │   └── main.js           # 入口文件
│   └── package.json
├── sql/                       # 数据库脚本
│   └── init.sql              # 初始化SQL
├── README.md                  # 项目说明
├── DEPLOYMENT.md             # 部署指南
└── PROJECT_SUMMARY.md        # 项目总结
```

## 配置说明

### 必需配置项

1. **数据库配置**（所有服务）
   - MySQL连接信息
   - Redis连接信息

2. **MinIO配置**（文件服务、文档解析服务）
   - Endpoint
   - Access Key / Secret Key
   - Bucket名称

3. **Milvus配置**（文档解析服务、对话服务）
   - Host / Port
   - Collection名称

4. **AI服务配置**
   - Embedding API URL和模型
   - DeepSeek API Key和模型

### 默认配置

- MySQL: localhost:3306
- Redis: localhost:6379
- MinIO: localhost:9000
- Milvus: localhost:19530
- 网关: localhost:8080
- 前端: localhost:3000

## 测试账号

- 管理员：admin / admin123
- 测试用户：test / test123

## 下一步优化建议

1. **性能优化**
   - 文档解析异步队列（RabbitMQ/Kafka）
   - 向量检索结果缓存
   - 大文件分片上传

2. **功能扩展**
   - 多文档联合问答
   - 文档内容高亮
   - 问答导出功能
   - 文档分类管理
   - 用户权限细化

3. **系统优化**
   - 服务注册发现（Nacos/Eureka）
   - 配置中心
   - 链路追踪
   - 监控告警

4. **安全增强**
   - 密码加密存储
   - JWT Token
   - 接口限流
   - 文件类型深度校验

## 注意事项

1. **Embedding服务**：需要单独部署Embedding API服务，或使用云服务
2. **DeepSeek API**：需要申请API Key并配置
3. **Milvus版本**：建议使用2.3.x版本，已测试兼容
4. **内存数据库**：MySQL建议使用内存型数据库以提高性能
5. **生产环境**：建议使用Docker容器化部署，便于管理

## 技术支持

如有问题，请查看：
- README.md - 项目说明
- DEPLOYMENT.md - 部署指南
- 各服务的application.yml - 配置说明

